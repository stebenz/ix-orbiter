kind: nodeagent.caos.ch/NodeAgents
version: v0
spec:
  commit: 9b000b26df1226439ec890417ac0abcfb7df925b
  nodeagents:
    first:
      changesallowed: true
      software:
        swap:
          version: disabled
        kubelet:
          version: v1.17.0
        kubeadm:
          version: v1.17.0
        kubectl:
          version: v1.17.0
        containerruntime:
          version: docker-ce v19.03.5
        keepalived:
          config:
            keepalived.conf: |+
              global_defs {
              	enable_script_security
              	script_user lauch
              }

              vrrp_sync_group VG1 {
              	group {
                      VI_0
                  }
              }

              vrrp_script chk_172.17.0.102 {
              	script       "/usr/local/bin/health 200@http://127.0.0.1:29999/ready"
              	interval 2   # check every 2 seconds
              	fall 15      # require 2 failures for KO
              	rise 2       # require 2 successes for OK
              }

              vrrp_instance VI_0 {
              	state MASTER
              	unicast_src_ip 10.10.10.197
              	unicast_peer {
              		    }
              	interface eth0
              	virtual_router_id 55
              	advert_int 1
              	authentication {
              		auth_type PASS
              		auth_pass [ REDACTED ]
              	}
              	track_script {
              		chk_172.17.0.102
              	}

              	virtual_ipaddress {
              		172.17.0.102
              	}

              }

        nginx:
          config:
            nginx.conf: "events {\n\tworker_connections  4096;  ## Default: 1024\n}\n\nstream
              { \n\tupstream kubeapi {    \n\t\tserver 10.10.10.197:6666; # masters\n\t}\n\tserver
              {\n\t\tlisten 172.17.0.102:6443;\n\t\tproxy_pass kubeapi;\n\t}\n}\n\nhttp
              {\n\tserver {\n\t\tlisten 29999;\n\n\t\tlocation /ready {\n\t\t\treturn
              200;\n\t\t}\n\t}\n}\n"
        hostname:
          config:
            hostname: master01
      firewall:
        calico-bgp:
          port: "179"
          protocol: tcp
        etcd:
          port: 2379-2380
          protocol: tcp
        kube-controller:
          port: "10252"
          protocol: tcp
        kube-scheduler:
          port: "10251"
          protocol: tcp
        kubeapi-6443-dest:
          port: "6443"
          protocol: tcp
        kubeapi-6443-src:
          port: "6443"
          protocol: tcp
        kubeapi-external:
          port: "6443"
          protocol: tcp
        kubeapi-internal:
          port: "6666"
          protocol: tcp
        kubelet:
          port: "10250"
          protocol: tcp
    second:
      changesallowed: false
      software:
        hostname:
          config:
            hostname: worker01
      firewall: null
